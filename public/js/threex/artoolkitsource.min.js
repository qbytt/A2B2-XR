var ARjs=ARjs||{},THREEx=THREEx||{};ARjs.Source=THREEx.ArToolkitSource=function(e){var t=this;this.ready=!1,this.domElement=null,this.parameters={sourceType:"webcam",sourceUrl:null,sourceWidth:640,sourceHeight:480,displayWidth:640,displayHeight:480},function(e){if(void 0===e)return;for(var i in e){var o=e[i];if(void 0!==o){var r=t.parameters[i];void 0!==r?t.parameters[i]=o:console.warn("THREEx.ArToolkitSource: '"+i+"' is not a property of this material.")}else console.warn("THREEx.ArToolkitSource: '"+i+"' parameter is undefined.")}}(e)},ARjs.Source.prototype.init=function(e,t){var i=this;if("image"===this.parameters.sourceType)var o=this._initSourceImage(r,t);else if("video"===this.parameters.sourceType)o=this._initSourceVideo(r,t);else if("webcam"===this.parameters.sourceType)o=this._initSourceWebcam(r,t);else console.assert(!1);return this.domElement=o,this.domElement.style.position="absolute",this.domElement.style.top="0px",this.domElement.style.left="0px",this.domElement.style.zIndex="-2",this;function r(){document.body.appendChild(i.domElement),i.ready=!0,e&&e()}},ARjs.Source.prototype._initSourceImage=function(e){var t=document.createElement("img");t.src=this.parameters.sourceUrl,t.width=this.parameters.sourceWidth,t.height=this.parameters.sourceHeight,t.style.width=this.parameters.displayWidth+"px",t.style.height=this.parameters.displayHeight+"px";var i=setInterval(function(){t.naturalWidth&&(e(),clearInterval(i))},20);return t},ARjs.Source.prototype._initSourceVideo=function(e){var t=document.createElement("video");t.src=this.parameters.sourceUrl,t.style.objectFit="initial",t.autoplay=!0,t.webkitPlaysinline=!0,t.controls=!1,t.loop=!0,t.muted=!0,document.body.addEventListener("click",function e(){document.body.removeEventListener("click",e),t.play()}),t.width=this.parameters.sourceWidth,t.height=this.parameters.sourceHeight,t.style.width=this.parameters.displayWidth+"px",t.style.height=this.parameters.displayHeight+"px";var i=setInterval(function(){t.videoWidth&&(e(),clearInterval(i))},20);return t},ARjs.Source.prototype._initSourceWebcam=function(e,t){var i=this;t=t||function(e){alert("Webcam Error\nName: "+e.name+"\nMessage: "+e.message)};var o=document.createElement("video");if(o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.setAttribute("playsinline",""),o.style.width=this.parameters.displayWidth+"px",o.style.height=this.parameters.displayHeight+"px",void 0===navigator.mediaDevices||void 0===navigator.mediaDevices.enumerateDevices||void 0===navigator.mediaDevices.getUserMedia){if(void 0===navigator.mediaDevices)var r="navigator.mediaDevices";else if(void 0===navigator.mediaDevices.enumerateDevices)r="navigator.mediaDevices.enumerateDevices";else if(void 0===navigator.mediaDevices.getUserMedia)r="navigator.mediaDevices.getUserMedia";else console.assert(!1);return t({name:"",message:"WebRTC issue-! "+r+" not present in your browser"}),null}return navigator.mediaDevices.enumerateDevices().then(function(r){var s={audio:!1,video:{facingMode:"environment",width:{ideal:i.parameters.sourceWidth},height:{ideal:i.parameters.sourceHeight}}};navigator.mediaDevices.getUserMedia(s).then(function(t){o.srcObject=t,document.body.addEventListener("click",function(){o.play()});var i=setInterval(function(){o.videoWidth&&(e(),clearInterval(i))},20)}).catch(function(e){t({name:e.name,message:e.message})})}).catch(function(e){t({message:e.message})}),o},ARjs.Source.prototype.hasMobileTorch=function(){var e=arToolkitSource.domElement.srcObject;if(e instanceof MediaStream==!1)return!1;void 0===this._currentTorchStatus&&(this._currentTorchStatus=!1);var t=e.getVideoTracks()[0];return void 0!==t.getCapabilities&&!!t.getCapabilities().torch},ARjs.Source.prototype.toggleMobileTorch=function(){console.assert(!0===this.hasMobileTorch());var e=arToolkitSource.domElement.srcObject;if(e instanceof MediaStream!=!1){void 0===this._currentTorchStatus&&(this._currentTorchStatus=!1);var t=e.getVideoTracks()[0];t.getCapabilities().torch?(this._currentTorchStatus=!1===this._currentTorchStatus,t.applyConstraints({advanced:[{torch:this._currentTorchStatus}]}).catch(function(e){console.log(e)})):alert("no mobile torch is available on your camera")}else alert("enabling mobile torch is available only on webcam")},ARjs.Source.prototype.domElementWidth=function(){return parseInt(this.domElement.style.width)},ARjs.Source.prototype.domElementHeight=function(){return parseInt(this.domElement.style.height)},ARjs.Source.prototype.onResizeElement=function(){var e=window.innerWidth,t=window.innerHeight;if(console.assert(0===arguments.length),"IMG"===this.domElement.nodeName)var i=this.domElement.naturalWidth,o=this.domElement.naturalHeight;else if("VIDEO"===this.domElement.nodeName)i=this.domElement.videoWidth,o=this.domElement.videoHeight;else console.assert(!1);var r=i/o;if(e/t<r){var s=r*t;this.domElement.style.width=s+"px",this.domElement.style.marginLeft=-(s-e)/2+"px",this.domElement.style.height=t+"px",this.domElement.style.marginTop="0px"}else{var n=1/(r/e);this.domElement.style.height=n+"px",this.domElement.style.marginTop=-(n-t)/2+"px",this.domElement.style.width=e+"px",this.domElement.style.marginLeft="0px"}},ARjs.Source.prototype.copyElementSizeTo=function(e){window.innerWidth>window.innerHeight?(e.style.width=this.domElement.style.width,e.style.height=this.domElement.style.height,e.style.marginLeft=this.domElement.style.marginLeft,e.style.marginTop=this.domElement.style.marginTop):(e.style.height=this.domElement.style.height,e.style.width=4*parseInt(e.style.height)/3+"px",e.style.marginLeft=(window.innerWidth-parseInt(e.style.width))/2+"px",e.style.marginTop=0)},ARjs.Source.prototype.copySizeTo=function(){console.warn("obsolete function arToolkitSource.copySizeTo. Use arToolkitSource.copyElementSizeTo"),this.copyElementSizeTo.apply(this,arguments)},ARjs.Source.prototype.onResize=function(e,t,i){if(3!==arguments.length)return console.warn("obsolete function arToolkitSource.onResize. Use arToolkitSource.onResizeElement"),this.onResizeElement.apply(this,arguments);var o=e.parameters.trackingBackend;"artoolkit"===o?(this.onResizeElement(),!1===!!t.domElement.dataset.aframeCanvas&&this.copyElementSizeTo(t.domElement),null!==e.arController&&this.copyElementSizeTo(e.arController.canvas)):"aruco"===o?(this.onResizeElement(),this.copyElementSizeTo(t.domElement),this.copyElementSizeTo(e.arucoContext.canvas)):"tango"===o?t.setSize(window.innerWidth,window.innerHeight):console.assert(!1,"unhandled trackingBackend "+o);if("artoolkit"===o)null!==e.arController&&i.projectionMatrix.copy(e.getProjectionMatrix());else if("aruco"===o)i.aspect=t.domElement.width/t.domElement.height,i.updateProjectionMatrix();else if("tango"===o){var r=e._tangoContext.vrDisplay;r&&"Tango VR Device"===r.displayName&&THREE.WebAR.resizeVRSeeThroughCamera(r,i)}else console.assert(!1,"unhandled trackingBackend "+o)};